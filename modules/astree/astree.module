<?php
function astree_node_view_alter(&$build){
	if ($build['#view_mode'] == 'full'){
		drupal_add_library("system", "ui.tabs");
		drupal_add_css(drupal_get_path('module', 'astree')."/astree.css");
		// We have to substitue comments field, rather than add some
		// new field, because the outter theme (node.tpl.php) did a specific
		// work to put comments field to the bottom
		$build['comments'] = array(
				'#markup' => theme('astree_tabs',
						array(
								'comments' => $build['comments'],
								'children' => NULL,
								'related' => NULL
						)
				),
		);
// 		unset($build['comments']);
// 		print_r($build);
	}
}

function astree_theme(){
	return array(
			'astree_tabs' => array(
					'template' => 'astree_tabs',
					'variables' => array('children' => NULL, 'related' => NULL, 'comments' => NULL),
			),
	);
}

